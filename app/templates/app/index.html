{% extends 'app/base.html' %}

{% load humanize %}
{% load url_params %}
{% load update_renderer %}
{% load static %}

{% block title %}EV Charging Station Updates{% endblock %}

{% block script_extra %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const interestingFields = [
        'state',
        'ev_network',
        'dc_fast',
        'only_new',
    ];
    const filter_form = document.getElementById('filter-form');

    for (const field of interestingFields) {
        const el = document.getElementById(field);
        el.addEventListener('change', function() {
            filter_form.submit();
        });
    }
});
</script>
{% endblock %}

{% block content %}
    <div class="header">
        <h1>
            <a href="{% url 'index' %}" title="Charge Beacon home (click to reset filters)">
                <img src="{% static 'app/img/logo.png' %}" alt="Charge Beacon Logo">
                <span>Charge Beacon</span>
            </a>
        </h1>
        <p>
            Subscribe to updates for chargers in your region.
        </p>
    </div>
    <form method="get" id="filter-form">
        <div class="filter-header">
            <div class="search-input">
                <label for="state">State</label>
                <select name="state" id="state">
                    <option value="">---</option>
                    {% for state in states %}
                        <option value="{{ state.id }}" {% if request.GET.state == state.id %}selected{% endif %}>{{ state.name }} ({{ state.count }})</option>
                    {% endfor %}
                </select>
            </div>
            <div class="search-input">
                <label for="ev_network">EV Network</label>
                <select name="ev_network" id="ev_network">
                    <option value="">---</option>
                    {% for ev_network in networks %}
                        <option value="{{ ev_network.id }}" {% if request.GET.ev_network == ev_network.id %}selected{% endif %}>{{ ev_network.name }} ({{ ev_network.count }})</option>
                    {% endfor %}
                </select>
            </div>
            <div class="search-input-group">
                <div class="search-input">
                    <label for="dc_fast">DC Fast</label>
                    <input type="checkbox" name="dc_fast" id="dc_fast" value="true" {% if request.GET.dc_fast == 'true' %}checked{% endif %}>
                </div>
                <div class="search-input">
                    <label for="only_new">Only Show New</label>
                    <input type="checkbox" name="only_new" id="only_new" value="true" {% if request.GET.only_new == 'true' %}checked{% endif %}>
                </div>
            </div>
        </div>
    </form>
    <div class="updates-container">
        {% for update in updates %}
                {% station_card update %}
        {% endfor %}
    </div>

    <div class="footer">
        <div class="pagination">
            <span class="step-links">
                {% if updates.has_previous %}
                    <a href="{% url_params page=1 %}">&laquo; first</a>
                    <a href="{% url_params page=updates.previous_page_number %}">previous</a>
                {% endif %}

                <span class="current">
                    Page {{ updates.number }} of {{ updates.paginator.num_pages }}.
                </span>

                {% if updates.has_next %}
                    <a href="{% url_params page=updates.next_page_number %}">next</a>
                    <a href="{% url_params page=updates.paginator.num_pages %}">last &raquo;</a>
                {% endif %}
            </span>
        </div>
        <div class="footer-links">
            <span>Created by <a href="https://sam.sutch.net">Samuel Sutch</a></span>
        </div>
    </div>
{% endblock %}
